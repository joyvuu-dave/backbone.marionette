// MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v1.0.0
//
// Copyright (c)2013 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://marionettejs.com



/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */

var Marionette=function(e,t,i){"use strict";var n={};e.Marionette=n;var r=Array.prototype.slice;return n.extend=e.Model.extend,n.getOption=function(e,t){if(e&&t){var i;return i=e.options&&t in e.options&&void 0!==e.options[t]?e.options[t]:e[t]}},n.triggerMethod=function(){for(var e,i,n=Array.prototype.slice.apply(arguments),r=n[0],o=r.split(":"),s="on",h=0;o.length>h;h++)e=o[h],i=e.charAt(0).toUpperCase(),s+=i+e.slice(1);return this.trigger.apply(this,n),t.isFunction(this[s])?(n.shift(),this[s].apply(this,n)):void 0},n.MonitorDOMRefresh=function(){function e(e){e._isShown=!0,n(e)}function i(e){e._isRendered=!0,n(e)}function n(e){e._isShown&&e._isRendered&&t.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}return function(t){t.listenTo(t,"show",function(){e(t)}),t.listenTo(t,"render",function(){i(t)})}}(),function(e){function i(e,i,n,r){var o=r.split(/\s+/);t.each(o,function(t){var r=e[t];if(!r)throw Error("Method '"+t+"' was configured as an event handler, but does not exist.");e.listenTo(i,n,r,e)})}function n(e,t,i,n){e.listenTo(t,i,n,e)}function r(e,i,n,r){var o=r.split(/\s+/);t.each(o,function(){var t=e[t];e.stopListening(i,n,t,e)})}function o(e,t,i,n){e.stopListening(t,i,n,e)}function s(e,i,n,r,o){i&&n&&(t.isFunction(n)&&(n=n.call(e)),t.each(n,function(n,s){t.isFunction(n)?r(e,i,s,n):o(e,i,s,n)}))}e.bindEntityEvents=function(e,t,r){s(e,t,r,n,i)},e.unbindEntityEvents=function(e,t,i){s(e,t,i,o,r)}}(n),n.Callbacks=function(){this._deferred=i.Deferred(),this._callbacks=[]},t.extend(n.Callbacks.prototype,{add:function(e,t){this._callbacks.push({cb:e,ctx:t}),this._deferred.done(function(i,n){t&&(i=t),e.call(i,n)})},run:function(e,t){this._deferred.resolve(t,e)},reset:function(){var e=this._callbacks;this._deferred=i.Deferred(),this._callbacks=[],t.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),n.Controller=function(e){this.triggerMethod=n.triggerMethod,this.options=e||{},t.isFunction(this.initialize)&&this.initialize(this.options)},n.Controller.extend=n.extend,t.extend(n.Controller.prototype,e.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),n.Region=function(e){if(this.options=e||{},this.el=n.getOption(this,"el"),!this.el){var t=Error("An 'el' must be specified for a region.");throw t.name="NoElError",t}if(this.initialize){var i=Array.prototype.slice.apply(arguments);this.initialize.apply(this,i)}},t.extend(n.Region,{buildRegion:function(e,i){var n="string"==typeof e,r="string"==typeof e.selector,o=e.regionType===void 0,s="function"==typeof e;if(!s&&!n&&!r)throw Error("Region must be specified as a Region type, a selector string or an object with selector property");var h,a;n&&(h=e),e.selector&&(h=e.selector),s&&(a=e),!s&&o&&(a=i),e.regionType&&(a=e.regionType);var l=new a({el:h});return e.parentEl&&(l.getEl=function(i){var n=e.parentEl;return t.isFunction(n)&&(n=n()),n.find(i)}),l}}),t.extend(n.Region.prototype,e.Events,{show:function(e){this.ensureEl(),this.close(),e.render(),this.open(e),n.triggerMethod.call(e,"show"),n.triggerMethod.call(this,"show",e),this.currentView=e},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(e){return i(e)},open:function(e){this.$el.empty().append(e.el)},close:function(){var e=this.currentView;e&&!e.isClosed&&(e.close?e.close():e.remove&&e.remove(),n.triggerMethod.call(this,"close"),delete this.currentView)},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),n.Region.extend=n.extend,n.RegionManager=function(e){var i=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.prototype.constructor.call(this,t)},addRegions:function(e,i){var n={};return t.each(e,function(e,r){"string"==typeof e&&(e={selector:e}),e.selector&&(e=t.defaults({},e,i));var o=this.addRegion(r,e);n[r]=o},this),n},addRegion:function(i,n){var r,o=t.isObject(n),s=t.isString(n),h=!!n.selector;return r=s||o&&h?e.Region.buildRegion(n,e.Region):n,this._store(i,r),this.triggerMethod("region:add",i,r),r},get:function(e){return this._regions[e]},removeRegion:function(e){var t=this._regions[e];this._remove(e,t)},removeRegions:function(){t.each(this._regions,function(e,t){this._remove(t,e)},this)},closeRegions:function(){t.each(this._regions,function(e){e.close()},this)},close:function(){this.removeRegions();var t=Array.prototype.slice.call(arguments);e.Controller.prototype.close.apply(this,t)},_store:function(e,i){this._regions[e]=i,this.length=t.size(this._regions)},_remove:function(e,t){t.close(),delete this._regions[e],this.triggerMethod("region:remove",e,t)}}),n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._regions),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(n),n.TemplateCache=function(e){this.templateId=e},t.extend(n.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new n.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=Array.prototype.slice.apply(arguments),i=t.length;if(i>0)for(e=0;i>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),t.extend(n.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var t=i(e).html();if(!t||0===t.length){var n="Could not find template: '"+e+"'",r=Error(n);throw r.name="NoTemplateError",r}return t},compileTemplate:function(e){return t.template(e)}}),n.Renderer={render:function(e,t){var i="function"==typeof e?e:n.TemplateCache.get(e),r=i(t);return r}},n.View=e.View.extend({constructor:function(){t.bindAll(this,"render");var i=Array.prototype.slice.apply(arguments);e.View.prototype.constructor.apply(this,i),n.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:n.triggerMethod,getTemplate:function(){return n.getOption(this,"template")},mixinTemplateHelpers:function(e){e=e||{};var i=this.templateHelpers;return t.isFunction(i)&&(i=i.call(this)),t.extend(e,i)},configureTriggers:function(){if(this.triggers){var e={},i=t.result(this,"triggers");return t.each(i,function(t,i){e[i]=function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation();var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(t,i)}},this),e}},delegateEvents:function(e){this._delegateDOMEvents(e),n.bindEntityEvents(this,this.model,n.getOption(this,"modelEvents")),n.bindEntityEvents(this,this.collection,n.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(i){i=i||this.events,t.isFunction(i)&&(i=i.call(this));var n={},r=this.configureTriggers();t.extend(n,i,r),e.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){var t=Array.prototype.slice.call(arguments);e.View.prototype.undelegateEvents.apply(this,t),n.unbindEntityEvents(this,this.model,n.getOption(this,"modelEvents")),n.unbindEntityEvents(this,this.collection,n.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(!this.isClosed){var e=this.triggerMethod("before:close");e!==!1&&(this.isClosed=!0,this.triggerMethod("close"),this.remove())}},bindUIElements:function(){this.ui&&(this.uiBindings||(this.uiBindings=t.result(this,"ui")),this.ui={},t.each(t.keys(this.uiBindings),function(e){var t=this.uiBindings[e];this.ui[e]=this.$(t)},this))}}),n.ItemView=n.View.extend({constructor:function(){var e=Array.prototype.slice.apply(arguments);n.View.prototype.constructor.apply(this,e)},serializeData:function(){var e={};return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var e=this.serializeData();e=this.mixinTemplateHelpers(e);var t=this.getTemplate(),i=n.Renderer.render(t,e);return this.$el.html(i),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){if(!this.isClosed){this.triggerMethod("item:before:close");var e=Array.prototype.slice.apply(arguments);n.View.prototype.close.apply(this,e),this.triggerMethod("item:closed")}}}),n.CollectionView=n.View.extend({itemViewEventPrefix:"itemview",constructor:function(){this._initChildViewStorage();var e=Array.prototype.slice.apply(arguments);n.View.prototype.constructor.apply(this,e),this._initialEvents()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},addChildView:function(e){this.closeEmptyView();var t=this.getItemView(e),i=this.collection.indexOf(e);this.addItemView(e,t,i)},onShowCalled:function(){this.children.each(function(e){n.triggerMethod.call(e,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView()},showCollection:function(){var e;this.collection.each(function(t,i){e=this.getItemView(t),this.addItemView(t,e,i)},this)},showEmptyView:function(){var t=n.getOption(this,"emptyView");if(t&&!this._showingEmptyView){this._showingEmptyView=!0;var i=new e.Model;this.addItemView(i,t,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getItemView:function(){var e=n.getOption(this,"itemView");if(!e){var t=Error("An `itemView` must be specified");throw t.name="NoItemViewError",t}return e},addItemView:function(e,i,r){var o=n.getOption(this,"itemViewOptions");t.isFunction(o)&&(o=o.call(this,e,r));var s=this.buildItemView(e,i,o);this.addChildViewEventForwarding(s),this.triggerMethod("before:item:added",s),this.children.add(s),this.renderItemView(s,r),this._isShown&&n.triggerMethod.call(s,"show"),this.triggerMethod("after:item:added",s)},addChildViewEventForwarding:function(e){var t=n.getOption(this,"itemViewEventPrefix");this.listenTo(e,"all",function(){var i=r.call(arguments);i[0]=t+":"+i[0],i.splice(1,0,e),n.triggerMethod.apply(this,i)},this)},renderItemView:function(e,t){e.render(),this.appendHtml(this,e,t)},buildItemView:function(e,i,n){var r=t.extend({model:e},n),o=new i(r);return o},removeItemView:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},removeChildView:function(e){e&&(this.stopListening(e),e.close&&e.close(),this.children.remove(e)),this.triggerMethod("item:removed",e)},checkEmpty:function(){this.collection&&0!==this.collection.length||this.showEmptyView()},appendHtml:function(e,t){e.$el.append(t.el)},_initChildViewStorage:function(){this.children=new e.ChildViewContainer},close:function(){if(!this.isClosed){this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed");var e=Array.prototype.slice.apply(arguments);n.View.prototype.close.apply(this,e)}},closeChildren:function(){this.children.each(function(e){this.removeChildView(e)},this),this.checkEmpty()}}),n.CompositeView=n.CollectionView.extend({constructor:function(){var e=Array.prototype.slice.apply(arguments);n.CollectionView.apply(this,e),this.itemView=this.getItemView()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this._renderChildren,this))},getItemView:function(){var e=n.getOption(this,"itemView")||this.constructor;if(!e){var t=Error("An `itemView` must be specified");throw t.name="NoItemViewError",t}return e},serializeData:function(){var e={};return this.model&&(e=this.model.toJSON()),e},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var e=this.renderModel();return this.$el.html(e),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(n.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e);var t=this.getTemplate();return n.Renderer.render(t,e)},appendHtml:function(e,t){var i=this.getItemViewContainer(e);i.append(t.el)},getItemViewContainer:function(e){if("$itemViewContainer"in e)return e.$itemViewContainer;var i;if(e.itemViewContainer){var n=t.result(e,"itemViewContainer");if(i=e.$(n),0>=i.length){var r=Error("The specified `itemViewContainer` was not found: "+e.itemViewContainer);throw r.name="ItemViewContainerMissingError",r}}else i=e.$el;return e.$itemViewContainer=i,i},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),n.Layout=n.ItemView.extend({regionType:n.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),n.ItemView.call(this,e)},render:function(){this._firstRender?this._firstRender=!1:this.isClosed?this._initializeRegions():this._reInitializeRegions();var e=Array.prototype.slice.apply(arguments),t=n.ItemView.prototype.render.apply(this,e);return t},close:function(){if(!this.isClosed){this.regionManager.close();var e=Array.prototype.slice.apply(arguments);n.ItemView.prototype.close.apply(this,e)}},addRegion:function(e,t){var i={};return i[e]=t,this.addRegions(i)[e]},addRegions:function(e){return this.regions=t.extend(this.regions||{},e),this._buildRegions(e)},removeRegion:function(e){return this.regionManager.removeRegion(e)},_buildRegions:function(e){var t=this,i={parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,i)},_initializeRegions:function(e){var i;this._initRegionManager(),i=t.isFunction(this.regions)?this.regions(e):this.regions||{},this.addRegions(i)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(e){e.reset()})},_initRegionManager:function(){this.regionManager=new n.RegionManager,this.listenTo(this.regionManager,"region:add",function(e,t){this[e]=t,this.trigger("region:add",e,t)}),this.listenTo(this.regionManager,"region:remove",function(e,t){delete this[e],this.trigger("region:remove",e,t)})}}),n.AppRouter=e.Router.extend({constructor:function(t){var i=Array.prototype.slice.apply(arguments);if(e.Router.prototype.constructor.apply(this,i),this.options=t,this.appRoutes){var r=n.getOption(this,"controller");this.processAppRoutes(r,this.appRoutes)}},processAppRoutes:function(e,i){var n,r,o,s,h,a=[],l=this;for(o in i)i.hasOwnProperty(o)&&a.unshift([o,i[o]]);for(s=a.length,h=0;s>h;h++){if(o=a[h][0],r=a[h][1],n=e[r],!n){var c="Method '"+r+"' was not found on the controller",d=Error(c);throw d.name="NoMethodError",d}n=t.bind(n,e),l.route(o,r,n)}}}),n.Application=function(i){this._initRegionManager(),this._initCallbacks=new n.Callbacks,this.vent=new e.Wreqr.EventAggregator,this.commands=new e.Wreqr.Commands,this.reqres=new e.Wreqr.RequestResponse,this.submodules={},t.extend(this,i),this.triggerMethod=n.triggerMethod},t.extend(n.Application.prototype,e.Events,{execute:function(){var e=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,e)},request:function(){var e=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,e)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("initialize:before",e),this._initCallbacks.run(e,this),this.triggerMethod("initialize:after",e),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},removeRegion:function(e){this._regionManager.removeRegion(e)},module:function(){var e=r.call(arguments);return e.unshift(this),n.Module.create.apply(n.Module,e)},_initRegionManager:function(){this._regionManager=new n.RegionManager,this.listenTo(this._regionManager,"region:add",function(e,t){this[e]=t}),this.listenTo(this._regionManager,"region:remove",function(e){delete this[e]})}}),n.Application.extend=n.extend,n.Module=function(e,t){this.moduleName=e,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,this.triggerMethod=n.triggerMethod},t.extend(n.Module.prototype,e.Events,{addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(t.each(this.submodules,function(t){var i=!0;i=t.startWithParent,i&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,n.triggerMethod.call(this,"before:stop"),t.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),n.triggerMethod.call(this,"stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(r,o){if(r){var s=t.flatten([this,this.app,e,n,i,t,o]);r.apply(this,s)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new n.Callbacks,this._finalizerCallbacks=new n.Callbacks}}),t.extend(n.Module,{create:function(e,i,n){var o=e,s=r.apply(arguments);s.splice(0,3),i=i.split(".");var h=i.length,a=[];return a[h-1]=n,t.each(i,function(t,i){var n=o;o=this._getModule(n,t,e),this._addModuleDefinition(n,o,a[i],s)},this),o},_getModule:function(e,t,i){var r=e[t];return r||(r=new n.Module(t,i),e[t]=r,e.submodules[t]=r),r},_addModuleDefinition:function(e,i,n,r){var o,s;t.isFunction(n)?(o=n,s=!0):t.isObject(n)?(o=n.define,s=n.startWithParent):s=!0,o&&i.addDefinition(o,r),i.startWithParent,i.startWithParent=i.startWithParent&&s,i.startWithParent&&!i.startWithParentIsConfigured&&(i.startWithParentIsConfigured=!0,e.addInitializer(function(e){i.startWithParent&&i.start(e)}))}}),n}(Backbone,_,$||window.jQuery||window.Zepto||window.ender);
//@ sourceMappingURL=backbone.marionette.map